import{L as Be}from"./Loading-BaoWSLnQ.js";import{d as ye,O as Ve,l as I,P as $e,y as Ce,Q as ne,o as A,g as te,w as l,m,b as s,n as d,i as t,a as X,B as oe,A as le,R as Me,T as fe,z as ve,U as ke,V as ze,W as Fe,L as xe,X as We,Y as ae,Z as ie,$ as Je,a0 as Ke,j as Ge,s as He,x as Ye,a1 as je,a2 as c,S as E,a3 as qe,a4 as Qe,H as ge,G as D,a5 as Xe,a6 as q,a7 as Q,p as Ze,f as he,k as B,a8 as et,q as tt,C as ot,t as U,I as st,a9 as se,aa as nt,ab as lt,ac as ce,K as at,E as it,ad as rt,M as ut,_ as dt}from"./index--8fEwDZf.js";import{E as mt}from"./el-checkbox-BqspqWVY.js";import{E as pt}from"./el-drawer-jhwpdpvQ.js";const ft={class:"orp"},vt={"w-full":""},gt={class:"op-item"},ct={key:0,class:"op-item"},_t={class:"op-item"},yt={key:1,class:"op-item"},Vt={class:"op-item"},Ct={key:2,class:"op-item"},kt={class:"op-item"},xt={"w-full":""},wt={class:"op-item"},St={class:"op-item"},bt={"mt-1":"",flex:"","flex-row":"","flex-items-center":"","flex-justify-center":""},Et=ye({__name:"OperationRecordPanel",setup(O){const{saveDialog:x,saveConfig:$,showCopyBtn:M}=We(),{openOperationRecordDrawer:R}=Ve(),z={merge_mouse_options:{merge:!0,max_interval_ms:300,merge_drag:!0},merge_key_options:{merge_repeat:!0,repeat_max_interval_ms:50,merge_press_release:!0,press_release_max_interval_ms:200},generateComment:!1,hiddenWindowBeforeRunning:!0},i=I(z),[F,V]=$e("operation-capture-setting-form");Ce(()=>{F.value&&(i.value=JSON.parse(JSON.stringify(F.value)))}),ne(i,()=>{V(i.value)},{deep:!0});const N=()=>{i.value=JSON.parse(JSON.stringify(z))},C=I(!1),Z=async()=>{C.value=!0;try{i.value.hiddenWindowBeforeRunning&&(Me.hide(),await fe.notify.sendCustom({name:"init",message:""}));const T=await ve.captureOperation(JSON.parse(JSON.stringify(i.value)),i.value.generateComment);await fe.notify.sendCustom({name:"stop",message:""}),$.name="操作记录",$.code=T,x.value=!0,M.value=!0}catch(T){console.error(T)}finally{C.value=!1}},h=()=>ve.stopCaptureOperation();return(T,o)=>{const p=ke,w=ze,W=Fe,L=xe,r=pt;return A(),te(r,{modelValue:t(R),"onUpdate:modelValue":o[9]||(o[9]=a=>le(R)?R.value=a:null),title:"操作录制面板",direction:"rtl",size:"50%",class:"orp-drawer"},{default:l(()=>[m("div",ft,[m("div",vt,[m("div",gt,[s(p,null,{default:l(()=>o[10]||(o[10]=[d("合并重复输入的按键")])),_:1}),s(w,{modelValue:t(i).merge_key_options.merge_repeat,"onUpdate:modelValue":o[0]||(o[0]=a=>t(i).merge_key_options.merge_repeat=a)},null,8,["modelValue"])]),t(i).merge_key_options.merge_repeat?(A(),X("div",ct,[s(p,null,{default:l(()=>o[11]||(o[11]=[d("需要合并的重复按键按下时间最大间隔(ms)")])),_:1}),s(W,{style:{"margin-left":"10px"},modelValue:t(i).merge_key_options.repeat_max_interval_ms,"onUpdate:modelValue":o[1]||(o[1]=a=>t(i).merge_key_options.repeat_max_interval_ms=a),min:1,size:"small"},null,8,["modelValue"])])):oe("",!0),m("div",_t,[s(p,null,{default:l(()=>o[12]||(o[12]=[d("合并相同按键的按下和释放")])),_:1}),s(w,{modelValue:t(i).merge_key_options.merge_press_release,"onUpdate:modelValue":o[2]||(o[2]=a=>t(i).merge_key_options.merge_press_release=a)},null,8,["modelValue"])]),t(i).merge_key_options.merge_press_release?(A(),X("div",yt,[s(p,null,{default:l(()=>o[13]||(o[13]=[d("需要合并的按键按下与释放最大间隔(ms)")])),_:1}),s(W,{style:{"margin-left":"10px"},modelValue:t(i).merge_key_options.press_release_max_interval_ms,"onUpdate:modelValue":o[3]||(o[3]=a=>t(i).merge_key_options.press_release_max_interval_ms=a),min:1,size:"small"},null,8,["modelValue"])])):oe("",!0),m("div",Vt,[s(p,null,{default:l(()=>o[14]||(o[14]=[d("合并相同鼠标按钮按下和释放")])),_:1}),s(w,{modelValue:t(i).merge_mouse_options.merge,"onUpdate:modelValue":o[4]||(o[4]=a=>t(i).merge_mouse_options.merge=a)},null,8,["modelValue"])]),t(i).merge_mouse_options.merge?(A(),X("div",Ct,[s(p,null,{default:l(()=>o[15]||(o[15]=[d("需要合并的鼠标按钮按下与释放最大间隔(ms)")])),_:1}),s(W,{style:{"margin-left":"10px"},modelValue:t(i).merge_mouse_options.max_interval_ms,"onUpdate:modelValue":o[5]||(o[5]=a=>t(i).merge_mouse_options.max_interval_ms=a),min:1,size:"small"},null,8,["modelValue"])])):oe("",!0),m("div",kt,[s(p,null,{default:l(()=>o[16]||(o[16]=[d("合并鼠标按下与释放时坐标不一致为拖拽")])),_:1}),s(w,{modelValue:t(i).merge_mouse_options.merge_drag,"onUpdate:modelValue":o[6]||(o[6]=a=>t(i).merge_mouse_options.merge_drag=a)},null,8,["modelValue"])])]),m("div",xt,[m("div",wt,[s(p,null,{default:l(()=>o[17]||(o[17]=[d("生成注释")])),_:1}),s(w,{modelValue:t(i).generateComment,"onUpdate:modelValue":o[7]||(o[7]=a=>t(i).generateComment=a)},null,8,["modelValue"])]),m("div",St,[s(p,null,{default:l(()=>o[18]||(o[18]=[d("开始录制时隐藏本窗口")])),_:1}),s(w,{modelValue:t(i).hiddenWindowBeforeRunning,"onUpdate:modelValue":o[8]||(o[8]=a=>t(i).hiddenWindowBeforeRunning=a)},null,8,["modelValue"])]),m("div",bt,[s(L,{onClick:N},{default:l(()=>o[19]||(o[19]=[d("重置选项")])),_:1}),t(C)?(A(),te(L,{key:1,type:"warning",onClick:h},{default:l(()=>o[21]||(o[21]=[d("停止录制")])),_:1})):(A(),te(L,{key:0,type:"primary",onClick:Z},{default:l(()=>o[20]||(o[20]=[d("开始录制")])),_:1}))])])])]),_:1},8,["modelValue"])}}}),Dt=(O,x)=>{O.addAction({id:"fastFillParams",label:"快速填写参数",keybindings:[ae.CtrlCmd|ie.Tab],contextMenuGroupId:"navigation",contextMenuOrder:0,run:x})},At=(O,x)=>{O.addAction({id:"insertSnippetCode",label:"插入代码片段",keybindings:[ae.chord(ae.CtrlCmd|ie.KeyK,ie.KeyI)],contextMenuGroupId:"navigation",contextMenuOrder:.1,run:x})},_e={auxiliaryActionRegister:Dt,insertSnippetCodeActionRegister:At},Rt={class:"script-editor-dev"},Tt={flex:"","flex-row":"","flex-items-center":""},Lt={class:"dialog-footer"},Pt={class:"dialog-footer"},Ut={class:"dialog-footer"},It={class:"dialog-footer"},Ot={id:"codeEditBox"},Nt={class:"loading"},Bt=ye({__name:"CodeEditor",setup(O){const x=Je("snippetSearchRef"),$=st,M=Ke(),R=Ge(),{scriptList:z}=He(R),{findEditor:i,editorInit:F,editorValue:V,insertText:N,setText:C,formatCode:Z,disposeEditor:h,registerEditorEvent:T,unRegisterEditorEvent:o}=Ve(),{openId:p,preloadText:w,preloadPath:W,isEditing:L,fileInfo:r,declareMod:a,saveMod:S}=he(),b=I(""),we=async()=>{const n=R.codeSnippets.find(e=>e.name===b.value);if(n){const e=await se.readFile(n.filePath);N(c,e.trim()),nt.success("代码片段插入成功")}P.value=!1},{invokeDynamicDialog:Se}=lt(),_=ce.getFnInfo(),{apiAutoTip:be}=ce,J=I(!0),K=n=>B().mockScriptList.value.find(v=>v.id===p.value)[n],re=I(),Ee=n=>{n.preventDefault();const{deltaY:e}=n;re.value.scrollLeft+=e},G=Ye({visible:!1,cb:()=>{},close_cb:()=>{}}),De=async()=>r.declare?(B().mockScriptList.value.find(n=>n.id===p.value).content=V.value,r.originData=V.value,D({title:"提示",message:"保存成功",type:"success",position:"bottom-right"}),!0):(D({title:"保存失败",message:"保存之前请先在脚本头部插入'脚本声明'或者将脚本声明补充完整",type:"error",position:"bottom-right"}),!1),Ae=async()=>{const n=await se.selectFile(!1);n&&(S.savePath=n,r.savePath=n)},Re=async()=>{S.visible=!1;try{await se.writeFile(r.savePath,V.value),r.originData=V.value;const n=at();return z.value.push({id:n,savePath:r.savePath,name:r.name,version:r.version,description:r.description,setting:{autoImportLastRunConfig:!1,targetAdbDevice:"",excludeDevice:[],targetApp:"",autoStartTargetApp:!1}}),p.value=n,D({title:"提示",message:"保存成功",type:"success",position:"bottom-right"}),!0}catch(n){return console.error(n),D({title:"保存失败",message:JSON.stringify(n),type:"error",position:"bottom-right"}),!1}},Te=()=>{N(c,`/**
 * 请勿删除，此声明会在脚本读取时用到！
 * @version:${a.version}
 * @name:${a.name}
 * @description:${a.description}
 */`,!0),a.description="无",a.name="未命名脚本",a.version="v1.0",a.visible=!1},ue=n=>{if(n.key==="s"&&n.ctrlKey){Z();const v=setTimeout(()=>{De(),clearTimeout(v)},200);n.preventDefault()}},P=I(!1),Le=()=>{if(_.value){if(!_.value.haveAuxiliary){D({title:"提示",message:"当前函数无需填写参数或不支持快速填写参数。",type:"info",position:"bottom-right"});return}const n=e=>{N(c,e,!1,_.value.paramsRange)};Se(_.value.name,_.value.name,_.value.content||"","changeArgs",n,_.value.params)}};let H=null;const de=()=>{ge.currentRoute.value.name==="scriptEditor"&&(H&&clearTimeout(H),H=setTimeout(()=>{clearTimeout(H);const n=V.value;if(n.indexOf(" */")===-1)r.declare=!1;else{const e=n.indexOf(" */")+3,v=V.value.substring(0,e),f={name:"",version:"",description:""};if(v.replaceAll("/**","").replace(/ \* -{19}提示-{19}[\s\S]* \* -{42}/,"").replaceAll(`
 * `,"").replaceAll(`
 */`,"").trim().split("@").forEach(y=>{if(y!==""){const g=y.split(":");g[0]==="version"?f.version=g[1]:g[0]==="name"?f.name=g[1]:g[0]==="description"&&(f.description=g[1])}}),f.description===""||f.name===""||f.version==="")r.declare=!1;else{const y=B().mockScriptList,g=y.value.findIndex(ee=>ee.id===p?.value);p?.value!=="-1"&&(y.value[g].version=f.version,y.value[g].name=f.name,y.value[g].description=f.description),r.declare=!0,r.version=f.version,r.name=f.name,r.description=f.description}}},500))};ne(V,()=>{de()});const Pe=n=>{be(),r.lastData=V.value},me=()=>{i(c)?.layout()},Ue=async(n="init",e)=>{{const v=K("content");r.originData=v||"",r.name=K("name"),r.description=K("description"),C(c,r.originData);return}};je();const Ie=(n,e)=>{const v=n?B().mockCodeSnippetList.value.filter(f=>f.name.toLowerCase().includes(b.value.toLowerCase())||f.description.toLowerCase().includes(b.value.toLowerCase())||f.prefix.toLowerCase().includes(b.value.toLowerCase())):B().mockCodeSnippetList.value;e(v)};Ce(async()=>{L.value=!0,J.value=!1,window.addEventListener("resize",me),F(c),await pe(),document.getElementById(c)?.addEventListener("keydown",ue),T("mounted",n=>{_e.auxiliaryActionRegister(n,Le),_e.insertSnippetCodeActionRegister(n,()=>{P.value=!0,setTimeout(()=>{x.value?.focus()})}),n.onDidChangeCursorPosition(Pe),C(c,r.originData||E());const e=setTimeout(()=>{de(),J.value=!0,clearTimeout(e)},200)})}),qe(()=>{Qe.clearCache(),o("mounted"),window.removeEventListener("resize",me),document.getElementById(c)?.removeEventListener("keydown",ue),h(),L.value=!1});const pe=async()=>{const n=ge.currentRoute.value.name;if(p.value!=="-1"&&n==="scriptEditor"){const e=K("savePath");if(e)try{Ue("init",e)}catch(v){console.error(v),D({title:"提示",message:"文件读取失败，进入新增模式",type:"error",position:"bottom-right"}),r.originData=E(),r.savePath="",C(c,E());return}else r.originData=E(),r.savePath="",C(c,E()),D({title:"提示",message:"文件读取失败，路径为空，进入新增模式",type:"error",position:"bottom-right"})}else p.value==="-1"&&n==="scriptEditor"&&(r.originData=E(),r.savePath="",C(c,E()))};return ne(p,pe),Xe(()=>{const n=w.value;et(()=>{C(c,n)})}),(n,e)=>{const v=Et,f=it,y=tt,g=ke,ee=rt,k=xe,Y=ot,j=ut,Oe=mt,Ne=Be;return A(),X("div",Rt,[s(v),s(Y,{modelValue:t(P),"onUpdate:modelValue":e[2]||(e[2]=u=>le(P)?P.value=u:null),title:"插入代码片段",width:"60%"},{footer:l(()=>[m("span",Lt,[s(k,{onClick:e[1]||(e[1]=u=>P.value=!1)},{default:l(()=>e[14]||(e[14]=[d("取消")])),_:1}),s(k,{type:"primary",onClick:we},{default:l(()=>e[15]||(e[15]=[d(" 确定 ")])),_:1})])]),default:l(()=>[s(ee,{modelValue:t(b),"onUpdate:modelValue":e[0]||(e[0]=u=>le(b)?b.value=u:null),"value-key":"name","fetch-suggestions":Ie,placeholder:"搜索代码片段:名称、备注、前缀",ref_key:"snippetSearchRef",ref:x},{suffix:l(()=>[s(f,null,{default:l(()=>e[13]||(e[13]=[m("span",{"i-mdi-text-search":""},null,-1)])),_:1})]),default:l(({item:u})=>[m("div",Tt,[s(y,{type:"primary",size:"small","mr-1":""},{default:l(()=>[d(U(u.prefix),1)]),_:2},1024),s(g,null,{default:l(()=>[d(U(u.name),1)]),_:2},1024)]),s(g,null,{default:l(()=>[d(U(u.description),1)]),_:2},1024)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),s(Y,{modelValue:t(a).visible,"onUpdate:modelValue":e[7]||(e[7]=u=>t(a).visible=u),title:"插入脚本声明"},{footer:l(()=>[m("span",Pt,[s(k,{onClick:e[6]||(e[6]=u=>t(a).visible=!1)},{default:l(()=>e[16]||(e[16]=[d("取消")])),_:1}),s(k,{type:"primary",onClick:Te},{default:l(()=>e[17]||(e[17]=[d(" 确定 ")])),_:1})])]),default:l(()=>[e[18]||(e[18]=m("div",null,"脚本名称",-1)),s(j,{modelValue:t(a).name,"onUpdate:modelValue":e[3]||(e[3]=u=>t(a).name=u)},null,8,["modelValue"]),e[19]||(e[19]=m("div",null,"脚本版本",-1)),s(j,{modelValue:t(a).version,"onUpdate:modelValue":e[4]||(e[4]=u=>t(a).version=u)},null,8,["modelValue"]),e[20]||(e[20]=m("div",null,"脚本描述",-1)),s(j,{modelValue:t(a).description,"onUpdate:modelValue":e[5]||(e[5]=u=>t(a).description=u)},null,8,["modelValue"])]),_:1},8,["modelValue"]),s(Y,{modelValue:t(S).visible,"onUpdate:modelValue":e[10]||(e[10]=u=>t(S).visible=u),title:"保存脚本"},{footer:l(()=>[m("span",Ut,[s(k,{onClick:e[9]||(e[9]=u=>t(S).visible=!1)},{default:l(()=>e[22]||(e[22]=[d("取消")])),_:1}),s(k,{type:"primary",onClick:Re},{default:l(()=>e[23]||(e[23]=[d(" 确定 ")])),_:1})])]),default:l(()=>[e[24]||(e[24]=m("div",null,"请选择脚本的保存路径",-1)),s(j,{modelValue:t(S).savePath,"onUpdate:modelValue":e[8]||(e[8]=u=>t(S).savePath=u)},{append:l(()=>[s(k,{type:"primary",onClick:Ae},{default:l(()=>e[21]||(e[21]=[d("选择")])),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),s(Y,{modelValue:t(G).visible,"onUpdate:modelValue":e[12]||(e[12]=u=>t(G).visible=u),title:"运行脚本"},{footer:l(()=>[m("span",It,[s(k,{onClick:t(G).close_cb},{default:l(()=>e[25]||(e[25]=[d("直接运行")])),_:1},8,["onClick"]),s(k,{type:"primary",onClick:t(G).cb},{default:l(()=>e[26]||(e[26]=[d(" 保存后运行 ")])),_:1},8,["onClick"])])]),default:l(()=>[e[27]||(e[27]=m("div",null,"检测到当前脚本已做更改，若不保存则运行最后一次保存的内容",-1)),s(Oe,{modelValue:t(M).editor.runAutoSave,"onUpdate:modelValue":e[11]||(e[11]=u=>t(M).editor.runAutoSave=u),label:"不再提醒,下次运行自动保存,可在设置页关闭自动保存",size:"large"},null,8,["modelValue"])]),_:1},8,["modelValue"]),q(m("div",Ot,null,512),[[Q,t(J)]]),q(m("div",Nt,[s(Ne),e[28]||(e[28]=m("div",null,"编辑器加载中...",-1))],512),[[Q,!t(J)]]),m("div",{class:"auto-api-tip scrollbar",onWheel:Ze(Ee,["stop"]),ref_key:"scrollbarRef",ref:re},[q(s(y,{style:{"margin-right":"3px"},size:"small",type:"success"},{default:l(()=>[d(U(t($)?"[鼠标右键]":"Ctrl+Tab ：")+"快速填写/修改参数 ",1)]),_:1},512),[[Q,t(_)?.haveAuxiliary]]),q(s(y,{size:"small",type:"info"},{default:l(()=>[d(U(t(_)?.name)+":"+U(t(_)?.content),1)]),_:1},512),[[Q,t(_)?.name&&t(_)?.content]])],544)])}}}),Wt=dt(Bt,[["__scopeId","data-v-f9662bc7"]]);export{Wt as default};
